---
phase: 03-code-quality-tooling
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/generate_changelog.py
autonomous: true

must_haves:
  truths:
    - "All public functions have type hints"
    - "mypy type checking passes"
    - "pip-audit reports no vulnerable dependencies"
    - "All quality tools pass together"
  artifacts:
    - path: "src/generate_changelog.py"
      provides: "Type-annotated source file"
      contains: "def.*->.*:"
  key_links:
    - from: "mypy"
      to: "src/generate_changelog.py"
      via: "type annotations on public functions"
      pattern: "Success: no issues found"
---

<objective>
Add type hints to all public functions and verify all quality tools pass

Purpose: Complete QUAL-05 (pip-audit), QUAL-06 (type hints), QUAL-07 (mypy), and final verification
Output: Fully type-annotated public functions, all quality tools passing
</objective>

<execution_context>
@/Users/robertfridzema/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertfridzema/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-code-quality-tooling/03-02-SUMMARY.md
@pyproject.toml
@src/generate_changelog.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add type hints to all public functions</name>
  <files>src/generate_changelog.py</files>
  <action>
Add type hints to the following public functions in generate_changelog.py:

1. `redact_api_key(text: str) -> str` - Already has type hints (verified)

2. `process_commits_in_chunks`:
```python
def process_commits_in_chunks(
    commits_raw: str,
    repo_url: str | None = None,
    chunk_size: int = 50
) -> tuple[list[str], list[str]]:
```

3. `get_language_config`:
```python
def get_language_config(language: str) -> dict[str, str]:
```

4. `retry_api_call`:
```python
from typing import Callable, TypeVar, Any
from functools import wraps

T = TypeVar("T")

def retry_api_call(
    max_retries: int = 3,
    delay: int = 2,
    timeout: int = 30
) -> Callable[[Callable[..., T]], Callable[..., T]]:
```
Note: This is a decorator factory returning a decorator.

5. `cleanup_temp_files`:
```python
def cleanup_temp_files() -> None:
```

Also add `from __future__ import annotations` at the top of the file for Python 3.9 compatibility with `X | None` syntax.

Import additions needed:
```python
from __future__ import annotations
from typing import Callable, TypeVar, Any
```
  </action>
  <verify>
Run: `grep -E "^def [a-z_]+\(.*\) ->|^def [a-z_]+\($" src/generate_changelog.py`
Expected: All public function definitions show return type annotations
  </verify>
  <done>All 5 public functions have type hints (parameters and return types)</done>
</task>

<task type="auto">
  <name>Task 2: Run mypy and fix any type errors</name>
  <files>src/generate_changelog.py</files>
  <action>
Run mypy on the source file:
```bash
mypy src/
```

Expected: "Success: no issues found" or minimal issues.

If errors appear:
- For "missing return statement": Add explicit returns
- For "incompatible types": Review and fix type annotations
- For "cannot find module": Covered by ignore_missing_imports=true
- For "untyped decorator": Add type to the decorator

Common patterns to fix:
- Functions that can return `None` implicitly need `-> X | None`
- Dict literals may need explicit type annotation
- Callable types need proper signature

After fixing, run again:
```bash
mypy src/
```

Must show: "Success: no issues found in X source files"
  </action>
  <verify>
Run: `mypy src/`
Expected: "Success: no issues found" (exit code 0)
  </verify>
  <done>mypy passes with no errors on src/</done>
</task>

<task type="auto">
  <name>Task 3: Run pip-audit and final verification</name>
  <files></files>
  <action>
Run pip-audit on both requirements files:
```bash
pip-audit -r requirements.txt
pip-audit -r requirements-dev.txt
```

Expected: "No known vulnerabilities found"

If vulnerabilities are found:
- For dev dependencies: Consider if upgrade is safe
- For production dependencies: Must address before Phase 4 CI

Final verification - run all quality tools together:
```bash
echo "=== Ruff Format Check ==="
ruff format --check src/ tests/

echo "=== Ruff Lint Check ==="
ruff check src/ tests/

echo "=== Mypy Type Check ==="
mypy src/

echo "=== pip-audit Security Scan ==="
pip-audit -r requirements.txt

echo "=== Test Suite ==="
pytest tests/ -v --tb=short
```

All commands must exit with code 0.
  </action>
  <verify>
Run: `pip-audit -r requirements.txt && pip-audit -r requirements-dev.txt`
Expected: Both commands report no vulnerabilities
  </verify>
  <done>pip-audit reports no vulnerable dependencies; all quality tools pass</done>
</task>

</tasks>

<verification>
1. `grep "from __future__ import annotations" src/generate_changelog.py` returns match
2. `mypy src/` exits with code 0 (no errors)
3. `pip-audit -r requirements.txt` reports no vulnerabilities
4. `pip-audit -r requirements-dev.txt` reports no vulnerabilities
5. `ruff check src/ tests/ && ruff format --check src/ tests/ && mypy src/ && pytest tests/` all pass
</verification>

<success_criteria>
- Type hints added to all 5 public functions in generate_changelog.py (QUAL-06)
- mypy passes with no errors (QUAL-07)
- pip-audit reports no vulnerable dependencies (QUAL-05)
- All quality tools (ruff check, ruff format, mypy, pip-audit) pass together
- Test suite still passes (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/03-code-quality-tooling/03-03-SUMMARY.md`
</output>
