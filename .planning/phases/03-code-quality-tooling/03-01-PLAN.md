---
phase: 03-code-quality-tooling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - requirements-dev.txt
autonomous: true

must_haves:
  truths:
    - "Ruff linting and formatting is configured"
    - "mypy type checking is configured"
    - "pip-audit can scan dependencies"
  artifacts:
    - path: "pyproject.toml"
      provides: "Ruff and mypy configuration"
      contains: "[tool.ruff]"
    - path: "requirements-dev.txt"
      provides: "Quality tool dependencies"
      contains: "ruff"
  key_links:
    - from: "pyproject.toml"
      to: "ruff check"
      via: "[tool.ruff.lint] select configuration"
      pattern: 'select.*=.*\["E"'
---

<objective>
Configure Ruff linting/formatting, mypy type checking, and pip-audit dependency scanning in pyproject.toml

Purpose: Establish the quality tooling foundation before applying fixes
Output: pyproject.toml with all tool configurations, requirements-dev.txt with new dependencies
</objective>

<execution_context>
@/Users/robertfridzema/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertfridzema/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-code-quality-tooling/03-RESEARCH.md
@pyproject.toml
@requirements-dev.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Ruff and mypy configuration to pyproject.toml</name>
  <files>pyproject.toml</files>
  <action>
Add the following sections to pyproject.toml (after existing pytest/coverage config):

```toml
[tool.ruff]
target-version = "py39"
line-length = 88
exclude = [".venv", "build", "dist", ".git", "__pycache__"]

[tool.ruff.lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # Pyflakes
    "I",      # isort
    "B",      # flake8-bugbear
    "S",      # flake8-bandit (security) - covers QUAL-04
    "UP",     # pyupgrade
]
ignore = [
    "E501",   # line too long (handled by formatter)
]

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["S101"]  # Allow assert in tests

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

[tool.mypy]
python_version = "3.9"
warn_return_any = true
warn_unused_configs = true
ignore_missing_imports = true
check_untyped_defs = true

[[tool.mypy.overrides]]
module = "tests.*"
ignore_errors = true
```

Key decisions (from research):
- Use Ruff S rules for security instead of standalone Bandit (100x faster, same checks)
- Start mypy with strict=false, add individual flags incrementally
- Ignore S101 in tests (assert statements are legitimate in tests)
- E501 ignored because formatter handles line breaks
  </action>
  <verify>
Run: `cat pyproject.toml | grep -A5 "\[tool.ruff\]"`
Expected: Shows Ruff configuration section
  </verify>
  <done>pyproject.toml contains [tool.ruff], [tool.ruff.lint], [tool.ruff.format], and [tool.mypy] sections</done>
</task>

<task type="auto">
  <name>Task 2: Update requirements-dev.txt with quality tools</name>
  <files>requirements-dev.txt</files>
  <action>
Add the following packages to requirements-dev.txt:

```
ruff>=0.14.0
mypy>=1.19
pip-audit>=2.10.0
types-requests
```

These are added to existing packages (pytest, pytest-cov, pytest-mock).

Note:
- ruff: Linting + formatting (replaces Flake8, Black, isort, Bandit)
- mypy: Static type checking
- pip-audit: Dependency vulnerability scanning (covers QUAL-05)
- types-requests: Type stubs for the requests library used in generate_changelog.py
  </action>
  <verify>
Run: `cat requirements-dev.txt`
Expected: Contains ruff, mypy, pip-audit, types-requests
  </verify>
  <done>requirements-dev.txt includes all quality tool dependencies</done>
</task>

<task type="auto">
  <name>Task 3: Install and verify tools are available</name>
  <files></files>
  <action>
Install the updated dev dependencies:
```bash
pip install -r requirements-dev.txt
```

Verify each tool is available:
```bash
ruff --version
mypy --version
pip-audit --version
```

Quick smoke test (expect errors at this stage, just verifying tools work):
```bash
ruff check src/ --output-format=text 2>&1 | head -20
```
  </action>
  <verify>
Run: `ruff --version && mypy --version && pip-audit --version`
Expected: All three commands return version numbers without errors
  </verify>
  <done>All quality tools installed and executable from command line</done>
</task>

</tasks>

<verification>
1. `cat pyproject.toml | grep "\[tool.ruff\]"` returns a match
2. `cat pyproject.toml | grep "\[tool.mypy\]"` returns a match
3. `grep "ruff" requirements-dev.txt` returns a match
4. `ruff --version` runs successfully
5. `mypy --version` runs successfully
6. `pip-audit --version` runs successfully
</verification>

<success_criteria>
- pyproject.toml contains complete Ruff configuration (lint + format)
- pyproject.toml contains mypy configuration with gradual adoption settings
- requirements-dev.txt includes ruff, mypy, pip-audit, types-requests
- All tools are installed and executable
</success_criteria>

<output>
After completion, create `.planning/phases/03-code-quality-tooling/03-01-SUMMARY.md`
</output>
