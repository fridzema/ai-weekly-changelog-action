---
phase: 01-code-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/generate_changelog.py
autonomous: true

must_haves:
  truths:
    - "Temp file cleanup errors are logged with specific exception type, not silently ignored"
    - "Extended data read errors are logged with details about what failed"
    - "Language fallback to English produces a visible warning in Action output"
  artifacts:
    - path: "src/generate_changelog.py"
      provides: "Exception handling and language fallback logging"
      contains: "except OSError"
      contains_also: "except (FileNotFoundError, PermissionError, UnicodeDecodeError)"
  key_links:
    - from: "cleanup_temp_files function"
      to: "print statement"
      via: "except OSError block"
      pattern: "except OSError.*print.*cleanup"
    - from: "extended data reading"
      to: "print statement"
      via: "except block with specific types"
      pattern: "except.*Error.*print.*extended"
    - from: "language config lookup"
      to: "print warning"
      via: "fallback detection"
      pattern: "output_language.*not in.*print.*warning|fallback"
---

<objective>
Fix bare exception handlers and add language fallback warning logging in the changelog generator.

Purpose: Create a clean foundation for testing by ensuring errors are properly logged and visible, not silently swallowed. Silent failures hide bugs and make debugging difficult.

Output: Updated `src/generate_changelog.py` with specific exception types, proper logging, and language fallback warnings.
</objective>

<execution_context>
@/Users/robertfridzema/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertfridzema/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/CONCERNS.md
@src/generate_changelog.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix bare exception handlers</name>
  <files>src/generate_changelog.py</files>
  <action>
Fix two bare exception handlers in src/generate_changelog.py:

1. **Lines 307-308 (cleanup_temp_files function)**:
   - Current: `except: pass`
   - Change to: `except OSError as e: print(f"Warning: Could not remove temp file {temp_file}: {e}")`
   - Why OSError: Covers file system errors (FileNotFoundError, PermissionError, etc.) which are the only realistic failures for os.remove()
   - Why not Exception: We want to catch ONLY file system errors, not programming bugs

2. **Lines 262-263 (extended data reading block)**:
   - Current: `except Exception as e: print(f"Warning: Could not read extended data: {e}")`
   - Wait, checking the actual code... Line 262-263 shows `except Exception as e:` which already has logging
   - The CONCERNS.md says it's a bare except, but reviewing the actual code shows it does log
   - Verify current state and if it IS bare, change to specific exceptions:
     `except (FileNotFoundError, PermissionError, UnicodeDecodeError, IOError) as e:`
   - Add more descriptive error: `print(f"Warning: Extended analysis data unavailable ({type(e).__name__}): {e}")`
   - This provides diagnostics about WHAT went wrong

Keep the existing behavior of graceful degradation (continue without extended data), but make failures visible.
  </action>
  <verify>
Run: `python3 -c "import src.generate_changelog" 2>&1 || true` should not show syntax errors.
Grep for "except:" in src/generate_changelog.py - should return 0 bare except clauses.
Grep for "except OSError" - should find the cleanup handler.
  </verify>
  <done>
- Line ~307: except OSError with logging replaces bare except pass
- Line ~262: specific exception types with descriptive logging
- No bare `except:` or `except Exception:` (overly broad) clauses remain in these locations
  </done>
</task>

<task type="auto">
  <name>Task 2: Add language fallback warning</name>
  <files>src/generate_changelog.py</files>
  <action>
Modify the language configuration lookup around line 211.

Current code:
```python
config = language_configs.get(output_language, language_configs["English"])
```

Change to:
```python
if output_language not in language_configs:
    print(f"Warning: Language '{output_language}' not supported. Falling back to English.")
    print(f"Supported languages: {', '.join(language_configs.keys())}")
    config = language_configs["English"]
else:
    config = language_configs[output_language]
```

This makes the fallback explicit and visible in GitHub Actions output, helping users understand why their language choice wasn't honored.

Place this AFTER line 209 (end of language_configs dict) and BEFORE the commits.txt reading block.
  </action>
  <verify>
Test with invalid language:
```bash
cd /Users/robertfridzema/workspace/ai-weekly-changelog-action
OUTPUT_LANGUAGE="Klingon" python3 -c "
import os
os.environ['OPENROUTER_API_KEY'] = 'sk-or-test'
os.environ['OUTPUT_LANGUAGE'] = 'Klingon'
exec(open('src/generate_changelog.py').read().split('# Read commits')[0])
" 2>&1 | grep -i "warning.*language"
```
Should output warning about unsupported language.
  </verify>
  <done>
- Invalid language input produces visible warning: "Warning: Language 'X' not supported. Falling back to English."
- Warning lists supported languages for user reference
- Valid language inputs work unchanged (no warning)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **No bare exceptions:**
   ```bash
   grep -n "except:" src/generate_changelog.py | grep -v "except.*:"
   ```
   Should return empty (no bare except clauses)

2. **Specific exception types present:**
   ```bash
   grep -n "except OSError\|except (FileNotFoundError" src/generate_changelog.py
   ```
   Should show the updated handlers

3. **Language warning present:**
   ```bash
   grep -n "not supported.*Falling back" src/generate_changelog.py
   ```
   Should show the warning code

4. **Script still runs:**
   ```bash
   python3 -m py_compile src/generate_changelog.py
   ```
   Should exit 0 (valid syntax)
</verification>

<success_criteria>
- FIX-01: Temp file cleanup uses `except OSError` with logging (not bare except pass)
- FIX-02: Extended data reading uses specific exception types with descriptive logging
- FIX-03: Language fallback produces visible warning with list of supported languages
- Script compiles without syntax errors
- Existing functionality unchanged (graceful degradation still works)
</success_criteria>

<output>
After completion, create `.planning/phases/01-code-foundation/01-01-SUMMARY.md`
</output>
