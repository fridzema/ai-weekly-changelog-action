---
phase: 04-cicd-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
  - README.md
autonomous: true

must_haves:
  truths:
    - "CI runs automatically on every push to main"
    - "CI runs automatically on every pull request to main"
    - "Lint failures show inline annotations on PR diffs"
    - "Test failures block merging with clear error output"
    - "Security scan results appear in job summary"
    - "README shows clickable CI status badge"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "CI workflow with 4 parallel jobs"
      contains: "astral-sh/ruff-action"
    - path: "README.md"
      provides: "CI status badge at top"
      contains: "actions/workflows/ci.yml/badge.svg"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "pyproject.toml"
      via: "tool configuration (ruff, mypy, pytest)"
      pattern: "ruff check|mypy src/|pytest tests/"
    - from: "README.md"
      to: ".github/workflows/ci.yml"
      via: "badge URL references workflow file"
      pattern: "workflows/ci.yml/badge.svg"
---

<objective>
Create GitHub Actions CI workflow with parallel jobs for lint, test, type-check, and security, plus add CI status badge to README.

Purpose: Automate quality checks on every push/PR so code quality is enforced automatically, not manually. The badge provides instant visibility of CI health.

Output: Working CI pipeline that runs 4 parallel jobs (lint, test, type-check, security) and a visible green badge in README.
</objective>

<execution_context>
@/Users/robertfridzema/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertfridzema/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-cicd-pipeline/04-RESEARCH.md

# Existing configuration (defines tool settings for CI to use)
@pyproject.toml
@requirements.txt
@requirements-dev.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CI workflow with parallel jobs</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Create `.github/workflows/ci.yml` with 4 parallel jobs:

**Workflow trigger configuration:**
- `on: push: branches: [main]` - run on push to main
- `on: pull_request: branches: [main]` - run on PRs targeting main

**Job 1: lint**
- `runs-on: ubuntu-latest`
- Use `actions/checkout@v4`
- Use `astral-sh/ruff-action@v3` with `args: "check --output-format=github src/ tests/"` (inline PR annotations)
- Use `astral-sh/ruff-action@v3` with `args: "format --check --diff src/ tests/"` (formatting check)

**Job 2: test**
- `runs-on: ubuntu-latest`
- Use `actions/checkout@v4`
- Use `actions/setup-python@v5` with `python-version: '3.11'`, `cache: 'pip'`, `cache-dependency-path` for both requirements files
- Install: `pip install -r requirements.txt -r requirements-dev.txt`
- Run: `pytest tests/ -v --cov=src --cov-report=term-missing --cov-fail-under=80`

**Job 3: type-check**
- `runs-on: ubuntu-latest`
- Use `actions/checkout@v4`
- Use `actions/setup-python@v5` with `python-version: '3.11'`, `cache: 'pip'`
- Install: `pip install mypy types-requests`
- Run: `mypy src/`

**Job 4: security**
- `runs-on: ubuntu-latest`
- Use `actions/checkout@v4`
- Use `actions/setup-python@v5` with `python-version: '3.11'`
- Install: `pip install -r requirements.txt -r requirements-dev.txt`
- Use `pypa/gh-action-pip-audit@v1.1.0` (provides GitHub summary integration)

**Important details:**
- Each job has descriptive `name:` field (Lint, Test, Type Check, Security Scan)
- All jobs run in parallel (no `needs:` dependencies between them)
- Use `python -m pip install --upgrade pip` before other pip commands
- Ruff action auto-detects version from pyproject.toml (no need to pin)
  </action>
  <verify>
File exists: `ls .github/workflows/ci.yml`
YAML valid: `python -c "import yaml; yaml.safe_load(open('.github/workflows/ci.yml'))"`
Contains 4 jobs: `grep -c "runs-on:" .github/workflows/ci.yml` returns 4
  </verify>
  <done>CI workflow file exists with lint, test, type-check, and security jobs configured to run in parallel on push/PR to main</done>
</task>

<task type="auto">
  <name>Task 2: Add CI status badge to README</name>
  <files>README.md</files>
  <action>
Add CI status badge at the very top of README.md, before the title.

**Badge markdown:**
```markdown
[![CI](https://github.com/fridzema/ai-weekly-changelog-action/actions/workflows/ci.yml/badge.svg)](https://github.com/fridzema/ai-weekly-changelog-action/actions/workflows/ci.yml)
```

**Placement:**
- Insert as first line of README.md
- Add blank line between badge and existing content

**Important:**
- URL uses workflow FILE name (`ci.yml`), not display name
- Badge links to workflow runs page (clickable for details)
- No branch parameter needed (defaults to default branch status)
  </action>
  <verify>
Badge present: `head -1 README.md | grep -q "badge.svg"` succeeds
Correct URL: `grep "workflows/ci.yml/badge.svg" README.md` finds the badge
  </verify>
  <done>README.md has CI status badge as first line, linking to workflow runs</done>
</task>

</tasks>

<verification>
**Local verification (before push):**
1. Workflow syntax valid: `python -c "import yaml; yaml.safe_load(open('.github/workflows/ci.yml'))"`
2. Badge markdown valid: `head -5 README.md` shows badge line

**After push verification (CI-05):**
1. Push to main triggers CI: Check GitHub Actions tab shows "CI" workflow running
2. All 4 jobs run in parallel: Jobs tab shows lint, test, type-check, security starting simultaneously
3. All jobs pass (green checkmarks)
4. Badge shows "passing" (may take a minute to update after first run)

**Requirement mapping:**
- CI-01 (tests on push/PR): test job runs pytest
- CI-02 (linting on push/PR): lint job runs ruff check + format check
- CI-03 (security scans): security job runs pip-audit, lint job runs ruff S rules
- CI-04 (badge in README): badge added at top
- CI-05 (all checks pass): verified by green badge after push
</verification>

<success_criteria>
1. `.github/workflows/ci.yml` exists with 4 parallel jobs
2. CI triggers on push to main and PRs to main
3. Lint job uses ruff-action with --output-format=github
4. Test job runs pytest with coverage threshold
5. Type-check job runs mypy
6. Security job runs pip-audit via official action
7. README.md has CI badge as first line
8. Badge URL correctly references ci.yml workflow file
</success_criteria>

<output>
After completion, create `.planning/phases/04-cicd-pipeline/04-01-SUMMARY.md`
</output>
