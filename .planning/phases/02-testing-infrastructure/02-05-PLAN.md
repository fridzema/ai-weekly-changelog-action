---
phase: 02-testing-infrastructure
plan: 05
type: execute
wave: 3
depends_on: ["02-02", "02-03", "02-04"]
files_modified:
  - tests/test_smoke.py
autonomous: false

must_haves:
  truths:
    - "Full test suite passes with pytest"
    - "Coverage report shows 80%+ on src/generate_changelog.py"
    - "All requirements TEST-01 through TEST-06 satisfied"
  artifacts:
    - path: "coverage report"
      provides: "Verification of 80% coverage target"
  key_links:
    - from: "pytest --cov"
      to: "src/generate_changelog.py"
      via: "Coverage measurement"
      pattern: "80%"
---

<objective>
Run full test suite and verify 80%+ coverage

Purpose: Final verification that all tests pass and coverage target (TEST-06) is met. This plan runs the complete test suite with coverage reporting and validates all phase success criteria.
Output: Coverage report showing 80%+ on src/generate_changelog.py, all tests green
</objective>

<execution_context>
@/Users/robertfridzema/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertfridzema/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-testing-infrastructure/02-CONTEXT.md
@tests/conftest.py
@tests/test_retry.py
@tests/test_redaction.py
@tests/test_chunking.py
@tests/test_language.py
@tests/test_changelog.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full test suite with coverage</name>
  <files>None (verification only)</files>
  <action>
Run the complete test suite with coverage measurement:

```bash
pytest tests/ --cov=src --cov-report=term-missing --cov-report=html -v
```

Expected output:
- All tests pass (should be ~35-45 tests total)
- Coverage report shows percentage for src/generate_changelog.py
- HTML report generated in htmlcov/ directory

If any tests fail:
1. Note the failure
2. Do NOT modify test files in this plan
3. Report failure for debugging in prior plans

Capture:
- Total test count
- Pass/fail count
- Coverage percentage for src/generate_changelog.py
- Any uncovered lines (term-missing output)
  </action>
  <verify>
```bash
pytest tests/ --cov=src --cov-report=term-missing -v 2>&1 | tail -30
```
  </verify>
  <done>
- Test suite runs completely
- Coverage report generated
- All tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Analyze coverage gaps and create summary</name>
  <files>None (analysis only)</files>
  <action>
Analyze the coverage report:

1. Check if coverage >= 80% on src/generate_changelog.py
2. If below 80%, identify which functions/lines are uncovered
3. Document coverage by major function:
   - redact_api_key() - should be ~100%
   - retry_api_call() - should be ~90%+
   - process_commits_in_chunks() - should be ~90%+
   - cleanup_temp_files() - should be ~100%
   - language_configs lookup - should be ~100%
   - Changelog file operations - should be ~80%+

4. Note any lines excluded by coverage config:
   - `if __name__ == "__main__":` blocks
   - `pragma: no cover` comments

Common uncovered areas that are acceptable:
- Module-level execution code (main script flow)
- Error messages in except blocks that are hard to trigger
- API response validation edge cases
  </action>
  <verify>
```bash
# Show coverage summary
pytest tests/ --cov=src --cov-report=term 2>&1 | grep -A5 "TOTAL"
```
  </verify>
  <done>
- Coverage percentage documented
- Uncovered lines identified and explained
- Coverage meets or exceeds 80% threshold
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete pytest test suite with coverage for src/generate_changelog.py</what-built>
  <how-to-verify>
1. Review test output:
   ```bash
   pytest tests/ --cov=src --cov-report=term-missing -v
   ```

2. Verify requirements met:
   - TEST-01: pytest runs with pyproject.toml config
   - TEST-02: Retry tests exist and pass (test_retry.py)
   - TEST-03: Chunking tests exist and pass (test_chunking.py)
   - TEST-04: Changelog tests exist and pass (test_changelog.py)
   - TEST-05: Language tests exist and pass (test_language.py)
   - TEST-06: Coverage >= 80%

3. Optional: View HTML coverage report:
   ```bash
   open htmlcov/index.html
   ```

4. Confirm all success criteria from roadmap are satisfied.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass and coverage >= 80%, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
```bash
# Final verification commands
pytest tests/ -v --tb=short
pytest tests/ --cov=src --cov-report=term --cov-fail-under=80
```

The `--cov-fail-under=80` flag will cause pytest to exit with error if coverage is below 80%.
</verification>

<success_criteria>
1. All tests pass (0 failures)
2. Coverage on src/generate_changelog.py >= 80%
3. `--cov-fail-under=80` passes (enforced threshold)
4. Requirements TEST-01 through TEST-06 all satisfied
5. Human verification approves test quality
</success_criteria>

<output>
After completion, create `.planning/phases/02-testing-infrastructure/02-05-SUMMARY.md`
</output>
